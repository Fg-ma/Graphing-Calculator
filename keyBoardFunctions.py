from variables import * 
import pyperclip
import math


def functionTypea():
    cursorPos[0] = cursorPos[0] + cursorPosDict["a"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "a"
        workingLine[cursorInlinePosition[0]] = "a"
    except:
        expressionList.append("a")
        workingLine.append("a")


def functionTypeb():
    cursorPos[0] = cursorPos[0] + cursorPosDict["b"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "b"
        workingLine[cursorInlinePosition[0]] = "b"
    except:
        expressionList.append("b")
        workingLine.append("b")


def functionTypec():
    cursorPos[0] = cursorPos[0] + cursorPosDict["c"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "c"
        workingLine[cursorInlinePosition[0]] = "c"
    except:
        expressionList.append("c")
        workingLine.append("c")


def functionTyped():
    cursorPos[0] = cursorPos[0] + cursorPosDict["d"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "d"
        workingLine[cursorInlinePosition[0]] = "d"
    except:
        expressionList.append("d")
        workingLine.append("d")


def functionTypee():
    cursorPos[0] = cursorPos[0] + cursorPosDict["e"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "e"
        workingLine[cursorInlinePosition[0]] = "e"
    except:
        expressionList.append("e")
        workingLine.append("e")


def functionTypef():
    cursorPos[0] = cursorPos[0] + cursorPosDict["f"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "f"
        workingLine[cursorInlinePosition[0]] = "f"
    except:
        expressionList.append("f")
        workingLine.append("f")


def functionTypeg():
    cursorPos[0] = cursorPos[0] + cursorPosDict["g"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "g"
        workingLine[cursorInlinePosition[0]] = "g"
    except:
        expressionList.append("g")
        workingLine.append("g")


def functionTypeh():
    cursorPos[0] = cursorPos[0] + cursorPosDict["h"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "h"
        workingLine[cursorInlinePosition[0]] = "h"
    except:
        expressionList.append("h")
        workingLine.append("h")


def functionTypei():
    cursorPos[0] = cursorPos[0] + cursorPosDict["i"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "i"
        workingLine[cursorInlinePosition[0]] = "i"
    except:
        expressionList.append("i")
        workingLine.append("i")


def functionTypej():
    cursorPos[0] = cursorPos[0] + cursorPosDict["j"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "j"
        workingLine[cursorInlinePosition[0]] = "j"
    except:
        expressionList.append("j")
        workingLine.append("j")


def functionTypek():
    cursorPos[0] = cursorPos[0] + cursorPosDict["k"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "k"
        workingLine[cursorInlinePosition[0]] = "k"
    except:
        expressionList.append("k")
        workingLine.append("k")


def functionTypel():
    cursorPos[0] = cursorPos[0] + cursorPosDict["l"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "l"
        workingLine[cursorInlinePosition[0]] = "l"
    except:
        expressionList.append("l")
        workingLine.append("l")


def functionTypem():
    cursorPos[0] = cursorPos[0] + cursorPosDict["m"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "m"
        workingLine[cursorInlinePosition[0]] = "m"
    except:
        expressionList.append("m")
        workingLine.append("m")


def functionTypen():
    cursorPos[0] = cursorPos[0] + cursorPosDict["n"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "n"
        workingLine[cursorInlinePosition[0]] = "n"
    except:
        expressionList.append("n")
        workingLine.append("n")


def functionTypeo():
    cursorPos[0] = cursorPos[0] + cursorPosDict["o"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "o"
        workingLine[cursorInlinePosition[0]] = "o"
    except:
        expressionList.append("o")
        workingLine.append("o")


def functionTypep():
    cursorPos[0] = cursorPos[0] + cursorPosDict["p"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "p"
        workingLine[cursorInlinePosition[0]] = "p"
    except:
        expressionList.append("p")
        workingLine.append("p")


def functionTypeq():
    cursorPos[0] = cursorPos[0] + cursorPosDict["q"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "q"
        workingLine[cursorInlinePosition[0]] = "q"
    except:
        expressionList.append("q")
        workingLine.append("q")


def functionTyper():
    cursorPos[0] = cursorPos[0] + cursorPosDict["r"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "r"
        workingLine[cursorInlinePosition[0]] = "r"
    except:
        expressionList.append("r")
        workingLine.append("r")


def functionTypes():
    cursorPos[0] = cursorPos[0] + cursorPosDict["s"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "s"
        workingLine[cursorInlinePosition[0]] = "s"
    except:
        expressionList.append("s")
        workingLine.append("s")


def functionTypet():
    cursorPos[0] = cursorPos[0] + cursorPosDict["t"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "t"
        workingLine[cursorInlinePosition[0]] = "t"
    except:
        expressionList.append("t")
        workingLine.append("t")


def functionTypeu():
    cursorPos[0] = cursorPos[0] + cursorPosDict["u"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "u"
        workingLine[cursorInlinePosition[0]] = "u"
    except:
        expressionList.append("u")
        workingLine.append("u")


def functionTypev():
    cursorPos[0] = cursorPos[0] + cursorPosDict["v"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "v"
        workingLine[cursorInlinePosition[0]] = "v"
    except:
        expressionList.append("v")
        workingLine.append("v")


def functionTypew():
    cursorPos[0] = cursorPos[0] + cursorPosDict["w"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "w"
        workingLine[cursorInlinePosition[0]] = "w"
    except:
        expressionList.append("w")
        workingLine.append("w")


def functionTypex():
    cursorPos[0] = cursorPos[0] + cursorPosDict["x"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "x"
        workingLine[cursorInlinePosition[0]] = "x"
    except:
        expressionList.append("x")
        workingLine.append("x")


def functionTypey():
    cursorPos[0] = cursorPos[0] + cursorPosDict["y"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "y"
        workingLine[cursorInlinePosition[0]] = "y"
    except:
        expressionList.append("y")
        workingLine.append("y")


def functionTypez():
    cursorPos[0] = cursorPos[0] + cursorPosDict["z"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "z"
        workingLine[cursorInlinePosition[0]] = "z"
    except:
        expressionList.append("z")
        workingLine.append("z")


def functionTypeExclamation():
    cursorPos[0] = cursorPos[0] + cursorPosDict["!"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "!"
        workingLine[cursorInlinePosition[0]] = "!"
    except:
        expressionList.append("!")
        workingLine.append("!")


def functionTypeAt():
    cursorPos[0] = cursorPos[0] + cursorPosDict["@"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "@"
        workingLine[cursorInlinePosition[0]] = "@"
    except:
        expressionList.append("@")
        workingLine.append("@")


def functionTypeNumberSign():
    cursorPos[0] = cursorPos[0] + cursorPosDict["#"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "#"
        workingLine[cursorInlinePosition[0]] = "#"
    except:
        expressionList.append("#")
        workingLine.append("#")


def functionTypeDollarSign():
    cursorPos[0] = cursorPos[0] + cursorPosDict["$"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "$"
        workingLine[cursorInlinePosition[0]] = "$"
    except:
        expressionList.append("$")
        workingLine.append("$")


def functionTypePercent():
    cursorPos[0] = cursorPos[0] + cursorPosDict["%"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "%"
        workingLine[cursorInlinePosition[0]] = "%"
    except:
        expressionList.append("%")
        workingLine.append("%")


def functionTypeAmpersand():
    cursorPos[0] = cursorPos[0] + cursorPosDict["&"]
    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
    try:
        expressionList[cursorInlinePosition[0]] = "&"
        workingLine[cursorInlinePosition[0]] = "&"
    except:
        expressionList.append("&")
        workingLine.append("&")


def functionTypeBackspace():

    """
    If the cursor is in the last position of the line then the last value is removed and the cursor moves accordingly,
    if the cursor is in any position but the last then whatever value that is above the cursor is removed.
    """

    if cursorInlinePosition[0] == len(expressionList) - 1 and not cursorInlinePosition[0] == -1:
        expressionList.pop(cursorInlinePosition[0])
        removed = workingLine.pop(cursorInlinePosition[0])
        if workingLineShifter[0] >= 0:
            cursorPos[0] = cursorPos[0] - cursorPosDict[removed]
        cursorInlinePosition[0] = cursorInlinePosition[0] - 1
        if not workingLineShifter[0] >= 0:
            workingLineShifter[0] = workingLineShifter[0] + cursorPosDict[removed]
    if cursorInlinePosition[0] < len(expressionList) - 1:
        expressionList.pop(cursorInlinePosition[0] + 1)
        workingLine.pop(cursorInlinePosition[0] + 1)


def functionTypeDelete():

    """
    Unlike backspace function, it only removes the value above the cursor,
    so if the cursor is in the last position in the line nothing happens.
    """

    if cursorInlinePosition[0] < len(expressionList) - 1:
        expressionList.pop(cursorInlinePosition[0] + 1)
        workingLine.pop(cursorInlinePosition[0] + 1)
        

def functionTypeControlC():

    """
    If not in history and there is a value in the workingline then it copies the workingline to the clipboard,
    if not in history and there is a no value in the workingline then it copies the previous answer(if there is one) to the clipboard,
    if not in history and there is a no value in the workingline and there is no answer history then nothing is copied to the clipboard,
    if in history then it copies whatever is selected(whether it is an answer or equation) to the clipboard
    """

    if inHistory[0] == "False":
        if workingLine == []:
            try:
                copy = list(answerHistory.items())[-1][1]
                pyperclip.copy(copy)
            except:
                pass
        else:
            copy = "".join(workingLine)
            pyperclip.copy(copy)
    else:
        if (selectionBarPos[0] % 2) == 1:
            answerPos = -math.ceil(selectionBarPos[0]/2)
            answer = list(answerHistory.values())[answerPos]
            pyperclip.copy(answer)
        else:
            problemPos = -math.ceil(selectionBarPos[0]/2)
            problem = list(problemHistory.values())[problemPos]
            pyperclip.copy(problem)

        # Variable cleanup
        if needSave[0] == "False":
            needSave[0] = "True"
            lines.clear()
            for i in save[0]:
                lines.append(i)
            workingLinePos[0] = save[1]
            numLines[0] = save[2]
        firstHistoryUpdate[0] = "True"
        inHistory[0] = "False"
        selectionBarPos[0] = 0


def functionTypeControlV():

    """
    Pastes whatever is in the clipboard to the working line.
    """

    paste = pyperclip.paste()
    for i in [*paste]:
        cursorPos[0] = cursorPos[0] + cursorPosDict[i]
        cursorInlinePosition[0] = cursorInlinePosition[0] + 1
        workingLine.append(i)
        expressionList.append(i)
    

def functionTypeControlZ():

    """
    If the working line isn't empty then it removes the last value from the working line,
    if the working line is empty it undoes the previous answer history if there is one
    (when this happens the previous equation history(now the current working line) is split into individual characters).
    """

    if workingLine == []:
        try:
            if answerHistory and not numLines[0] == 0:
                answerHistory.popitem()
                lines.pop()
                newOldLine = problemHistory.popitem()
                workingLinePos[0] = workingLinePos[0] - sizeOfShift
                answerHistoryCount[0] = answerHistoryCount[0] - 1
                numLines[0] = numLines[0] - 1
                for i in [*newOldLine[1]]:
                    cursorPos[0] = cursorPos[0] + cursorPosDict[i]
                    cursorInlinePosition[0] = cursorInlinePosition[0] + 1
                    expressionList.append(i)
                    workingLine.append(i)
        except:
            pass
    else:
        expressionList.pop(cursorInlinePosition[0])
        removed = workingLine.pop(cursorInlinePosition[0])
        if workingLineShifter[0] >= 0:
            cursorPos[0] = cursorPos[0] - cursorPosDict[removed]
        cursorInlinePosition[0] = cursorInlinePosition[0] - 1
        if not workingLineShifter[0] >= 0:
            workingLineShifter[0] = workingLineShifter[0] + cursorPosDict[removed]


def cursorGetLength(str):

    """
    Gets where the cursor should land given the current expression
    """

    brokenList = [*str]
    for i in brokenList:
        cursorPos[0] = cursorPos[0] + cursorPosDict[i]